var editor=ace.edit("editor",{mode:"ace/mode/javascript",selectionStyle:"text"});editor.setTheme("ace/theme/github"),editor.session.setMode("ace/mode/javascript");var EditSession=ace.require("ace/edit_session").EditSession,Range=ace.require("ace/range").Range,js=new EditSession("some js code"),questionTemplate='<div class="question-expand" onclick="expandQ(this)">\n<p class="question-content-text">\n  \n</p>\n<p class="question-content-count">\n  Submitted #: <span class="count">1</span>\n</p>\n<div class="question-answers">\n  <div class="answer-container">\n   \n    \n  </div>\n \n</div>\n</div>',answerTemplate='         \n\n  <div class="answer">\n    <p class="answer-student-name">\n      Devin\n    </p>\n    <div class="answer-text">\n      Hi\n\n  </div>\n  \n</div>\n\n</div>\n\n';function createElementFromHTML(e){var n=document.createElement("div");return n.innerHTML=e.trim(),n.firstChild}var Question=function(){const e=function(e,n,t){this.answerText=n,this.studentName=t,this.element=createElementFromHTML(answerTemplate),i[e].element.querySelector(".answer-container").appendChild(this.element),console.log(this.element),this.studentNameDiv=this.element.querySelector(".answer-student-name"),this.textDiv=this.element.querySelector(".answer-text"),this.changeAnswerView(n,t)};e.prototype.changeAnswerView=function(e,n){this.studentNameDiv.innerHTML=n,this.textDiv.innerHTML=e};var n=document.querySelector(".questions"),t=document.querySelector(".add-question"),s=t.querySelector("textarea");t.style.display="none";var i=[];return{enableAddQuestionUI:e=>{t.style.display="block"},turnOffAddQuestionUI:e=>{t.style.display="none"},addQuestion:()=>{var e=s.value;let t=createElementFromHTML(questionTemplate);i.push({questionText:e,answers:{},element:t}),sendNewQuestion(e),n.appendChild(t),t.querySelector(".question-content-text").innerHTML=e,s.value=""},addAnswer:(n,t,s)=>{i[n].answers[s]?i[n].answers[s].changeAnswerView(t,s):i[n].answers[s]=new e(n,t,s)}}}(),code=editor.session.getDocument();function reformatData(e){return"insert"==e.action?function(e){var n="i"+e.start.row.toString()+"/!"+e.start.column.toString();return e.lines.forEach(e=>{n+="/!"+e}),console.log(n),n}(e):function(e){return"r"+e.start.row.toString()+"/!"+e.start.column.toString()+"/!"+e.end.row.toString()+"/!"+e.end.column.toString()}(e)}var ws=new WebSocket("ws://"+window.location.hostname+":"+window.location.port);function sendNewQuestion(e){ws.send("q"+e)}code.on("change",e=>{ws.send(reformatData(e))}),ws.onopen=function(){ws.send("teacher"),ws.send(ClassCode),ws.send("initiliazation sequence #3- apply all previous changes")};const Handlers=function(){return{a:function(e){let n=e.split("/!");Question.addAnswer(n[0],n[1],n[2])}}}();ws.onmessage=function(e){let n=e.data;Handlers[n.charAt(0)](n.slice(1))};